<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <head>
        <style>
            #video {
                position: absolute;
                top: 0;
                left: 0;
                margin: 0;
                padding: 0;
                z-index: -1;
            }
            #sensibility, #log, #time {
                color: white;
                font-family: arial;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.3/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.3/locale/pt-br.js"></script>
        
        <script src="https://cdn.bootcss.com/tracking.js/1.1.3/tracking-min.js"></script>
        <script src="https://cdn.bootcss.com/tracking.js/1.1.3/data/eye-min.js"></script>
        <script src="https://cdn.bootcss.com/tracking.js/1.1.3/data/face-min.js"></script>
        <script src="https://cdn.bootcss.com/tracking.js/1.1.3/data/mouth-min.js"></script>
        
        <script>
        $(() => {

            // Grab elements, create settings, etc.
            let video = $('#video')[0];



            // Get access to the camera!
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // Not adding `{ audio: true }` since we only want video now
                navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                    video.src = window.URL.createObjectURL(stream);
                    video.play();
                });
            }

            var colors = new tracking.ColorTracker(['magenta', 'yellow']);

            let magentaTop = -1;
            let yellowTop = -1;

            let magentaMs = -1; 
            let yellowMs = -1;

            let magenta = $('<div>');
            magenta.css({
                borderColor: 'magenta',
                borderWidth: 2,
                borderStyle: 'solid',
                position: 'absolute'
            });
            $(document.body).append(magenta);

            let yellow = $('<div>');
            yellow.css({
                borderColor: 'yellow',
                borderWidth: 2,
                borderStyle: 'solid',
                position: 'absolute'
            });
            $(document.body).append(yellow);

            colors.on('track', function(event) {
                if (event.data.length === 0) {
                    // No colors were detected in this frame.
                } else {
                    let sensibility = $('#sensibility').val();

                    event.data.forEach(function(rect) {
                        if (rect.color == 'yellow') {
                            yellow.css({
                                top: rect.y,
                                left: rect.x,
                                width: rect.width,
                                height: rect.height                                
                            });
                        } else if (rect.color == 'magenta') {
                            magenta.css({
                                top: rect.y,
                                left: rect.x,
                                width: rect.width,
                                height: rect.height                                
                            });
                        }
                        

                        if (rect.color == 'magenta') {
                            if (magentaTop == -1) {
                                
                            } else {
                                if (magentaTop - rect.y > sensibility) {
                                    $('#log').text('←');
                                    magentaMs = new Date().valueOf();                                    
                                }
                            }
                            magentaTop = rect.y;
                        } else if (rect.color == 'yellow') {
                            if (yellowTop == -1) {
                                
                            } else {
                                if (yellowTop - rect.y > sensibility) {
                                    $('#log').text('→');
                                    yellowMs = new Date().valueOf();
                                }
                            }
                            yellowTop = rect.y; 
                        }
                    });

                    $('#time').text(magentaMs + ' / ' + yellowMs);
                    if (magentaMs != -1 && yellowMs != -1 && Math.abs(magentaMs - yellowMs) < 1000) {
                        $('#log').text('↓');
                    }
                }
            });

            tracking.track('#video', colors);
        });           
        </script>
    </head>
    <body>
        <input id="sensibility" type="range" min="1" max="100" value="10">
        <div id="log"></div>
        <div id="time"></div>
        <video id="video" preload autoplay loop muted></video>
    </body>
</html>